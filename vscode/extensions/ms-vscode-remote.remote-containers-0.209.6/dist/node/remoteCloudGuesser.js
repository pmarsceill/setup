/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *--------------------------------------------------------------------------------------------*/

var m=Object.create;var d=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var l=Object.getOwnPropertyNames;var f=Object.getPrototypeOf,p=Object.prototype.hasOwnProperty;var P=t=>d(t,"__esModule",{value:!0});var v=(t,n,a)=>{if(n&&typeof n=="object"||typeof n=="function")for(let r of l(n))!p.call(t,r)&&r!=="default"&&d(t,r,{get:()=>n[r],enumerable:!(a=g(n,r))||a.enumerable});return t},w=t=>v(P(d(t!=null?m(f(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var c=w(require("http")),o;(function(e){e.Azure="azure",e.AWS="aws",e.DigitalOcean="digitalocean",e.GCP="gcp"})(o||(o={}));var S=[{id:o.Azure,url:"http://169.254.169.254/metadata/instance?api-version=2019-03-11",headers:{Metadata:"true"},match:/azEnvironment/},{id:o.DigitalOcean,url:"http://169.254.169.254/metadata/v1/id",match:/^\d{9}/},{id:o.AWS,url:"http://169.254.169.254/latest/meta-data/instance-id",match:/^i-[0-9a-f]{8}/},{id:o.GCP,url:"http://metadata.google.internal/computeMetadata/v1/instance/id",headers:{"Metadata-Flavor":"Google"},match:/^\d{10}/}];async function z(){let t,n=new Promise(a=>t=a);return Promise.race([Promise.all(S.map(({id:a,url:r,headers:e,match:s})=>A(r,e,n).then(i=>{s.test(i)&&t(a)},i=>{}))),new Promise(a=>setTimeout(a,7e3).unref())]).then(()=>t()),n}async function A(t,n,a){return new Promise((r,e)=>{let s=c.get(t,{headers:n},i=>{if(i.statusCode<200||i.statusCode>299)return i.destroy(),e(new Error(`Status ${i.statusCode}`));let u=[];i.on("data",h=>u.push(h)),i.on("end",()=>r(Buffer.concat(u).toString("utf8"))),i.on("error",e)});s.on("error",e),a.then(()=>s.abort())})}z().then(t=>console.log(t||""));
//# sourceMappingURL=remoteCloudGuesser.js.map
